# 聚合

# 1. 概念

其中一個原則：在單個事務中，只允許對一個聚合實例進行修改。

避免一個大聚合，會導致事務失敗。

父聚合：Product可以作為BacklogItem，Release，Sprint這三個聚合的根，關聯ProductId。

這種改造之後，將getter和setter命名具體化，plan，schedule，轉成CQS方法。

# 2. 原則

**一致性**：
- 設計良好的聚合，無論由於何種業務需求發生改變，在單個事務中，聚合中的所有不變條件都是一致的。
- 設計良好的界限上下文，無論哪種情況下，它都保證在一個事務中只修改一個聚合實例。
- 引用聚合和被引用聚合不可以在同一個事務中進行修改。
- 如果你試圖在單個事務中修改多個聚合，這往往意味著此時的一致性邊界是錯誤的。

**通過標誌引用**
- 在調用聚合方法時候，使用資源庫或領域服務來獲取所需要的對象。

![](/assets/arrgregate.png)