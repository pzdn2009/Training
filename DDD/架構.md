# 架構

# 1. 上下文映射圖

**上下文映射圖**（Context Map）：將不同的界限上下文映射起來。
- U：Upstream
- D：Downstream

方法：
- **合作關係**：兩個界限上下文的團隊要麼一起成功，要麼一起失敗。
- **共享內核**：對模型和代碼的共享將產生一種緊密的依賴性。
- **客戶方-供應方開發**：上游團隊獨立于下游團隊。
- **遵奉者**：下游團隊盲目地使用上游團隊的模型。
- **防腐層ACL**：下游團隊建立，對需要的上游團隊模型進行代理。
- **開放主機服務OHS**：公開給別人訪問。
  
  可以使用REST實現。也可以通過消息機制實現，如消息隊列。
- **發佈語言PH**：兩個界限上下文之間翻譯模型需要一種公用語言。通常與OHS一起使用。

  最常見的就是XML和JSON。也可以使用Protocol Buffer。如果發佈的是WEB用戶界面，也可以使用HTML，也可以發佈領域事件。
- **另謀他路**：如果兩套功能之間沒有顯著的關係，那麼他們是可以完全解耦的。
- **大泥球**：混雜模型，邊界模糊。

上下文映射圖的畫法：任意兩個界限上下文中，
- 直線連接方框，UD關係
- 方框，OHS/PL經常一起作為上游使用
- 方框，ACL經常作為下游使用

# 2. 分層
![](/assets/分層.png)

# 3. 六邊形架構（端口適配器）

六邊形分為兩部分：外部區域，內部區域。內部區域的核心是領域模型和應用程序，外部區域為適配器，主要處理程序的**輸入，輸出**，**內部調用**。

應用程序通過公共的API接收客戶請求。即內部區域不因外部的輸入而改變，只需採用適配器即可。

適配器類型：
- HTTP，瀏覽器，SOAP，REST，RPC。
- Repository（DB），Document，Distributed Cache，Memory Storage。
- AMQP。

![](/assets/六邊形.png)

# 4. EDA架構

定義：對於某個聚合上的每次命令操作，都有至少一個領域事件發佈出去，該領域事件描述了操作的執行結果。

![](/assets/EDA.png)

# 5. CQRS

Command-Query Responsibility Segregation。

一個方法要麼是執行某種動作的命令，要麼是返回數據的查詢，而不能兩者兼是。

- 客戶端和查詢處理器
- 查詢模型
- 客戶端驅動命令
- 命令處理器
- 命令模型執行業務行為
- 事件訂閱更新查詢模型
- 處理具有最終一致性的查詢模型
